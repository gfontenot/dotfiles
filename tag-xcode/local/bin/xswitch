#!/bin/bash

cmd_prefix=""
if [ "$(id -u)" != 0 ]; then
  cmd_prefix="sudo"
fi

other_apps=()

for app in $(xcode-list -f); do
  if [[ "$(xcode-current)" =~ "$app"* ]]; then
    continue
  fi

  other_apps+=("$app")
done

case "${#other_apps[@]}" in
  0)
    echo "No other Xcode found to switch to"
    exit 1
    ;;
  1)
    eval "$cmd_prefix /usr/bin/xcode-select --switch ${other_apps[0]}"
    ;;
  *)
    printf '%s\n' "other_apps[@]" \
      | fzf --query="$1" \
      | xargs -I{} $cmd_prefix xcode-select --switch {}
    ;;
esac

echo "Current Xcode is now '$(xcode-current)'"
