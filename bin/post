#!/usr/bin/env ruby
# 
# post
# 
# Created by Gordon Fontenot
# Contact: gordon.fontenot@me.com
# 
# useage: post [options] <post name>
# 
# Options:
#   -d    Create draft
#   -p    Create post (will be published on push)
#   -l    Designate the post as a link
# 
# For use inside a Jekyll website to create new blog posts
# since creating them manually basically sucks.
# 
# To use, you must be inside your jekyll website.
# If you use the -p flag, the post will be created inside
# the _posts directory. If you use -d, the post will be created
# inside the drafts directory (And will not be assigned a date)
# The -l flag is for creating a "link" post. Your clipboard will be
# pasted into the source field in the header.
# Designed to be used alongside the publish command


require 'fileutils'
require 'date'

unless File.exists?('_site') && File.directory?('_site')
  puts "This does not appear to be a Jekyll site."
  exit
end


draft = ARGV.delete("-d")
post = ARGV.delete("-p")
link = ARGV.delete("-l")

if (draft && post)
  puts "Can't be a draft and a post. Pick one."
  exit
elsif (!draft && !post)
  puts "Must be either a draft (-d) or a post (-p)"
  exit
end

name = ARGV.join(" ")
file_name = ARGV.join("-").downcase

if draft
  dir = "drafts"
else
  dir = "_posts"
  file_name = "#{Date.today.to_s}-#{file_name}"
end

FileUtils.touch("#{dir}/#{file_name}.markdown")

open("#{dir}/#{file_name}.markdown", "a") do |f|
  f.puts "---"
  f.puts "layout: post"
  f.puts "title: #{name}"
  if link
    f.puts "type: link"
    f.puts "source: #{`pbpaste`}"
  else
    f.puts "type: post"
  end
  f.puts "---"
end